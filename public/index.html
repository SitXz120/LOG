<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Moji Leaderboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
      body {
        background: linear-gradient(to bottom, #0f0f0f, #1a1a1a);
        color: white;
        font-family: 'Segoe UI', sans-serif;
      }
      
      .card-glow {
        box-shadow: 0 4px 20px rgba(0, 255, 204, 0.1);
        border-radius: 1rem;
        border: none;
      }
      
      .table th, .table td {
        vertical-align: middle;
      }
      
      .btn-glow {
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        transition: transform 0.2s ease, box-shadow 0.3s ease;
      }
      .btn-glow:hover {
        transform: translateY(-3px);
        box-shadow: 0 0 18px rgba(0, 255, 204, 0.5);
      }
      
      .display-5 {
        animation: fadeInDown 1s ease-out;
      }
      @keyframes fadeInDown {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes pulseGreen {
        0%, 100% { box-shadow: 0 0 10px rgba(0, 255, 100, 0.5); }
        50% { box-shadow: 0 0 15px rgba(0, 255, 100, 1); }
      }
      
      @keyframes pulseGray {
        0%, 100% { box-shadow: 0 0 5px rgba(150, 150, 150, 0.2); }
        50% { box-shadow: 0 0 10px rgba(150, 150, 150, 0.4); }
      }
      
      .pulse-online {
        animation: pulseGreen 1.5s infinite;
      }
      
      .pulse-offline {
        animation: pulseGray 1.5s infinite;
      }

  </style>
</head>
<body>

<!-- ‚úÖ Navbar -->

<nav class="navbar navbar-dark bg-dark shadow px-3 justify-content-between">
  <a href="/" class="navbar-brand fw-bold">üåê Moji Leaderboard</a>
  <div id="user-nav">
    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÇ‡∏î‡∏¢ JS -->
  </div>
</nav>

<!-- ‚úÖ Modal -->

<div class="modal fade" id="tokenModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-dark">
      <div class="modal-header">
        <h5 class="modal-title">üîë Token ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-center">
        <p class="fw-bold" id="tokenValue"></p>
      </div>
    </div>
  </div>
</div>

  <!-- ‚úÖ Modal Get Script Success -->
<div class="modal fade" id="getScriptModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-dark">
      <div class="modal-header">
        <h5 class="modal-title">üìã Script Ready!</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p>‚úÖ Token ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏ù‡∏±‡∏á‡πÉ‡∏ô Script ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</p>
        <p class="mb-0"><strong>üìå ‡∏ß‡∏≤‡∏á‡∏•‡∏á‡πÉ‡∏ô Executor ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</strong></p>
      </div>
    </div>
  </div>
</div>


<!-- ‚úÖ Modal Register/Login -->

<div class="modal fade" id="authModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-dark">
      <div class="modal-header">
        <h5 class="modal-title">üéüÔ∏è ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ / Login</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-center">
        <input type="text" id="authUsername" class="form-control mb-3" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
        <button class="btn btn-success mb-2 w-100" onclick="registerUser()">‚úÖ ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏´‡∏°‡πà</button>
        <button class="btn btn-primary w-100" onclick="loginUser()">üîê Login</button>
        <p class="mt-3 text-danger fw-bold" id="authStatus"></p>
      </div>
    </div>
  </div>
</div>

<!-- ‚úÖ Main Container -->

<div class="container py-5">
  <div class="text-center mb-5">
    <h1 class="display-5 fw-bold text-info shadow">üìä Moji Manager Tools</h1>
  </div>

  <!-- ‚úÖ Online/Offline Summary -->

  <div class="row text-center mb-4">
    <div class="col">
      <div class="alert alert-info fw-bold fs-5 shadow">üü¢ ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå: <span id="online-count">0</span> ‡∏Ñ‡∏ô</div>
    </div>
    <div class="col">
      <div class="alert alert-secondary fw-bold fs-5 shadow">üî¥ ‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå: <span id="offline-count">0</span> ‡∏Ñ‡∏ô</div>
    </div>
  </div>

  <!-- ‚úÖ Summary Row -->

  <div class="row mb-4">
    <div class="col-md-4 text-start">
      <button class="btn btn-danger btn-glow fw-bold w-100" onclick="resetScores()">üóëÔ∏è ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï Shooms ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    </div>
    <div class="col-md-4 text-center">
      <div class="alert alert-success fw-bold fs-5 mb-0 shadow" id="total">
        üí∞ ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: 0 Shooms
      </div>
    </div>
    <div class="col-md-4 text-end">
      <button class="btn btn-success btn-glow fw-bold w-100 position-relative" onclick="copyScript()">
        üìã Get Script
      </button>
      <p class="text-info mt-2 mb-0" id="copyStatus"></p>
    </div>
  </div>

  <!-- ‚úÖ Table -->

  <div class="table-responsive card-glow">
    <table class="table table-dark table-hover table-bordered mb-0 rounded">
      <thead>
        <tr class="text-center">
          <th>#</th>
          <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</th>
          <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Shooms</th>
          <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
        </tr>
      </thead>
      <tbody id="score-table"></tbody>
    </table>
  </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    async function fetchScores() {
    const token = localStorage.getItem('userToken');
    if (!token) return;

    const res = await fetch('/data', {
        method: 'POST',
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ token })
    });

    const scores = await res.json();
    if (!scores || scores.length === 0) return;

    const table = document.getElementById('score-table');
    const total = document.getElementById('total');
    const onlineCount = document.getElementById('online-count');
    const offlineCount = document.getElementById('offline-count');

    table.innerHTML = '';
    let totalScore = 0;
    let online = 0;
    let offline = 0;

    scores.forEach((item, i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
        <td class="text-center">${i + 1}</td>
        <td>${item.player}</td>
        <td class="text-end">${Number(item.score).toLocaleString()}</td>
        <td class="text-center">
          ${item.online
            ? '<span class="badge bg-success pulse-online">‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</span>'
            : '<span class="badge bg-secondary pulse-offline">‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå</span>'}
        </td>
        `;
        table.appendChild(tr);
        totalScore += Number(item.score);
        item.online ? online++ : offline++;
    });

    total.innerText = `üí∞ ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalScore.toLocaleString()} Shooms`;
    onlineCount.innerText = online;
    offlineCount.innerText = offline;
    }

  function openAuthModal() {
    document.getElementById('authUsername').value = '';
    document.getElementById('authStatus').innerText = '';
    new bootstrap.Modal(document.getElementById('authModal')).show();
  }

  async function registerUser() {
    const username = document.getElementById('authUsername').value.trim();
    const status = document.getElementById('authStatus');
    if (!username) {
      status.innerText = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠";
      return;
    }

    const res = await fetch('/register', {
      method: 'POST',
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username })
    });

    const data = await res.json();
    if (res.ok) {
      localStorage.setItem("userToken", data.token);
      location.reload();
    } else {
      status.innerText = `‚ùå ${data}`;
    }
  }

  async function loginUser() {
    const username = document.getElementById('authUsername').value.trim();
    const status = document.getElementById('authStatus');
    if (!username) {
      status.innerText = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠";
      return;
    }

    const res = await fetch('/login', {
      method: 'POST',
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username })
    });

    const data = await res.json();
    if (res.ok) {
      localStorage.setItem("userToken", data.token);
      location.reload();
    } else {
      status.innerText = `‚ùå ${data}`;
    }
  }

    function logout() {
    localStorage.removeItem('userToken');
    checkLogin(); // ‡πÅ‡∏ó‡∏ô location.reload()
    }

    async function checkLogin() {
    const token = localStorage.getItem('userToken');
    const nav = document.getElementById('user-nav');

    if (!token) {
        // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏° Login ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ Login
        nav.innerHTML = `
        <button class="btn btn-outline-light btn-sm" onclick="openAuthModal()">üéüÔ∏è Register / Login</button>
        `;
        return;
    }

    const res = await fetch('/me', {
        method: 'POST',
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ token })
    });

    if (!res.ok) {
        // ‚úÖ Token ‡∏ú‡∏¥‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏° Login ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
        localStorage.removeItem("userToken");
        nav.innerHTML = `
        <button class="btn btn-outline-light btn-sm" onclick="openAuthModal()">üéüÔ∏è Register / Login</button>
        `;
        return;
    }

    const data = await res.json();
    nav.innerHTML = `
        üë§ <strong>${data.username}</strong>
        <button class="btn btn-warning btn-sm ms-2" onclick="showToken()">üîë Token</button>
        <button class="btn btn-outline-danger btn-sm ms-2" onclick="logout()">üö™ Logout</button>
    `;
    }

    function showToken() {
    const token = localStorage.getItem('userToken');
    if (!token) {
        alert("‡πÑ‡∏°‡πà‡∏û‡∏ö Token");
        return;
    }

    document.getElementById('tokenValue').innerText = token;
    new bootstrap.Modal(document.getElementById('tokenModal')).show();
    }

    async function resetScores() {
    const confirmReset = confirm("‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï Shooms ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?");
    if (!confirmReset) return;

    const token = localStorage.getItem("userToken");
    if (!token) {
        alert("‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ Login");
        return;
    }

    const res = await fetch('/reset', {
        method: 'POST',
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ token })
    });

    if (res.ok) {
        fetchScores(); // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà
    } else {
        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï Shooms");
    }
    }

  fetchScores();
  setInterval(fetchScores, 3000);
  checkLogin();

  function copyScript() {
    const token = localStorage.getItem("userToken");
    if (!token) {
      document.getElementById("copyStatus").innerText = "‚ùó ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ Login ‡∏Å‡πà‡∏≠‡∏ô!";
      return;
    }
  
    const script = `
  getgenv().token = "${token}"
  loadstring(game:HttpGet("https://raw.githubusercontent.com/SitXz120/LOG/main/public/script.lua"))()
    `.trim();
  
    navigator.clipboard.writeText(script).then(() => {
      // ‚úÖ Show Modal
      const modal = new bootstrap.Modal(document.getElementById('getScriptModal'));
      modal.show();
    }).catch(() => {
      document.getElementById("copyStatus").innerText = "‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏î‡πâ";
    });
  }
  
</script>

</body>
</html>
