<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Moji</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
      body {
    background: linear-gradient(to bottom, #0f0f0f, #1a1a1a);
    color: white;
    font-family: 'Segoe UI', sans-serif;
  }
  
  .card-glow {
    box-shadow: 0 4px 20px rgba(0, 255, 204, 0.1);
    border-radius: 1rem;
    border: none;
  }
  
  .table th, .table td {
    vertical-align: middle;
  }
  
  .btn-glow {
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
    transition: transform 0.2s ease, box-shadow 0.3s ease;
  }
  .btn-glow:hover {
    transform: translateY(-3px);
    box-shadow: 0 0 18px rgba(0, 255, 204, 0.5);
  }
  
  .display-5 {
    animation: fadeInDown 1s ease-out;
  }
  
  @keyframes fadeInDown {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  @keyframes pulseGreen {
    0%, 100% { box-shadow: 0 0 4px rgba(0, 255, 100, 0.3); }
    50% { box-shadow: 0 0 8px rgba(0, 255, 100, 0.5); }
  }
  
  @keyframes pulseGray {
    0%, 100% { box-shadow: 0 0 3px rgba(150, 150, 150, 0.15); }
    50% { box-shadow: 0 0 6px rgba(150, 150, 150, 0.3); }
  }
  
  .pulse-online {
    animation: pulseGreen 1.5s infinite;
  }
  
  .pulse-offline {
    animation: pulseGray 1.5s infinite;
  }
  
  .badge.pulse-online, .badge.pulse-offline {
    border-radius: 30px;
    padding: 0.5em 1em;
    font-weight: bold;
    color: #fff;
    background-color: transparent;
    position: relative;
    z-index: 1;
  }
  .badge.pulse-online::before, .badge.pulse-offline::before {
    content: "";
    position: absolute;
    top: -4px; left: -10px; right: -10px; bottom: -4px;
    border-radius: 40px;
    z-index: -1;
    filter: blur(6px);
  }
  .badge.pulse-online::before {
    background: rgba(0, 255, 100, 0.25);
    animation: pulseGreen 1.5s infinite;
  }
  .badge.pulse-offline::before {
    background: rgba(150, 150, 150, 0.15);
    animation: pulseGray 1.5s infinite;
  }
  
  .alert-soft {
    background-color: rgba(255, 255, 255, 0.05);
    color: #fff;
    border: 1px solid rgba(255, 255, 255, 0.08);
    backdrop-filter: blur(3px);
    border-radius: 12px;
  }
  
  /* ‚úÖ ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á */
  #bgVideo {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    object-fit: cover;
    z-index: -10;
    opacity: 0.15;
    pointer-events: none;
    filter: blur(1px);
  }
  
  /* ‚úÖ ‡∏õ‡πä‡∏≠‡∏õ‡∏≠‡∏±‡∏û‡πÄ‡∏û‡∏•‡∏á */
  .music-popup {
    position: fixed;
    bottom: 20px;
    left: 20px;
    background: rgba(0, 0, 0, 0.5);
    padding: 10px 12px;
    border-radius: 10px;
    z-index: 99;
    display: flex;
    align-items: center;
    gap: 10px;
    backdrop-filter: blur(4px);
    box-shadow: 0 0 10px rgba(0,255,204,0.2);
  }
  .music-popup button {
    background: none;
    border: none;
    color: #fff;
    font-size: 20px;
    cursor: pointer;
  }
  .music-popup input[type="range"] {
    width: 100px;
  }
  
  /* ‚úÖ ‡∏Å‡∏•‡πà‡∏≠‡∏á Summary ‡πÉ‡∏´‡∏°‡πà */
  .summary-card {
    padding: 1rem;
    border-radius: 1rem;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.08);
    backdrop-filter: blur(4px);
    text-align: center;
    box-shadow: 0 0 8px rgba(0, 255, 204, 0.05);
    transition: transform 0.2s ease, box-shadow 0.3s ease;
  }
  .summary-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 0 18px rgba(0, 255, 204, 0.2);
  }
  .summary-card h5 {
    margin-bottom: 0.25rem;
    font-size: 1.25rem;
  }
  .summary-card span {
    font-size: 1.5rem;
    font-weight: bold;
  }
  .highlight-label {
    color: #00ffc8;
  }
  .text-danger {
    color: #ff5c5c !important;
  }
  .summary-card.small-card {
    padding: 0.75rem 1rem;
    min-height: 100px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }
  .summary-card.small-card h5 {
    font-size: 1rem;
    margin-bottom: 0.25rem;
  }
  .summary-card.small-card span {
    font-size: 1.25rem;
    font-weight: bold;
  }
  .label-online {
    color: #00ff88; /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏™‡∏î */
  }
  
  .label-offline {
    color: #ff5c5c; /* ‡πÅ‡∏î‡∏á‡πÅ‡∏£‡∏á‡∏§‡∏ó‡∏ò‡∏¥‡πå */
  }
  
  .label-accounts {
    color: #ffd700; /* ‡∏™‡∏µ‡∏ó‡∏≠‡∏á */
  }

  .modal-content {
    background-color: rgba(30, 30, 30, 0.97) !important;
    color: #f8f9fa;
  }
  
  .modal-header h5,
  .modal-body,
  .modal-footer {
    color: #f8f9fa !important;
  }
  
  .form-check-label {
    color: #e0e0e0 !important;
  }

  #pcCheckboxContainer label.form-check {
    display: flex;
    align-items: center;
    background-color: rgba(255, 255, 255, 0.05);
    border-radius: 6px;
    padding: 4px 8px;
    margin-right: 6px;
    margin-bottom: 6px;
    cursor: pointer;
    transition: background 0.3s;
  }
  
  #pcCheckboxContainer label.form-check:hover {
    background-color: rgba(0, 255, 204, 0.1);
  }
  
  #pcCheckboxContainer .form-check-input {
    margin-right: 6px;
  }

  #pcCheckboxContainer {
    justify-content: center; /* ‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ checkbox ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á */
  }
  
  #pcCheckboxContainer label.form-check {
    min-width: 100px;
    justify-content: center;
    text-align: center;
  }

  </style>
</head>
<body>
  
<!-- üé¨ Video Background -->
<video autoplay muted loop playsinline id="bgVideo">
  <source src="videos/moji-bg.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>

<!-- üéµ Music Player -->
<div id="music-control" class="music-popup">
  <audio id="bgMusic" src="audio/music.mp3" loop></audio>
  <button onclick="toggleMusic()">‚èØÔ∏è</button>
  <input type="range" id="musicVolume" min="0" max="1" step="0.01" value="0.1">
  <button onclick="closeMusicPopup()">‚ùå</button>
</div>
  
<!-- ‚úÖ Navbar -->

<nav class="navbar navbar-dark bg-dark shadow px-3 justify-content-between">
  <a href="/" class="navbar-brand fw-bold">üåê Moji Leaderboard</a>
  <div id="user-nav">
    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÇ‡∏î‡∏¢ JS -->
  </div>
</nav>

<!-- ‚úÖ Modal -->

<div class="modal fade" id="tokenModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-dark">
      <div class="modal-header">
        <h5 class="modal-title">üîë Token ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-center">
        <p class="fw-bold" id="tokenValue"></p>
      </div>
    </div>
  </div>
</div>

  <!-- ‚úÖ Modal Get Script Success -->
<div class="modal fade" id="getScriptModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-dark">
      <div class="modal-header">
        <h5 class="modal-title">üìã Script Ready!</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p>‚úÖ Token ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏ù‡∏±‡∏á‡πÉ‡∏ô Script ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</p>
        <p class="mb-0"><strong>üìå ‡∏ß‡∏≤‡∏á‡∏•‡∏á‡πÉ‡∏ô Executor ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</strong></p>
      </div>
    </div>
  </div>
</div>

<!-- ‚úÖ Modal Reset Confirm -->
<div class="modal fade" id="resetConfirmModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-dark">
      <div class="modal-header">
        <h5 class="modal-title">‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï Shooms ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button class="btn btn-danger" onclick="confirmResetScores()">üóëÔ∏è ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏•‡∏¢!</button>
      </div>
    </div>
  </div>
</div>


<!-- ‚úÖ Modal Register/Login -->

<div class="modal fade" id="authModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-dark">
      <div class="modal-header">
        <h5 class="modal-title">üéüÔ∏è ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ / Login</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-center">
        <input type="text" id="authUsername" class="form-control mb-3" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
        <button class="btn btn-success mb-2 w-100" onclick="registerUser()">‚úÖ ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏´‡∏°‡πà</button>
        <button class="btn btn-primary w-100" onclick="loginUser()">üîê Login</button>
        <p class="mt-3 text-danger fw-bold" id="authStatus"></p>
      </div>
    </div>
  </div>
</div>

<!-- üí∏ Modal ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ -->
<div class="modal fade" id="earningModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content text-dark">
      <div class="modal-header">
        <h5 class="modal-title">üí∞ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å Shoom</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label">üìâ ‡πÄ‡∏£‡∏ó Shoom ‡∏ï‡πà‡∏≠ 1 ‡∏ö‡∏≤‡∏ó:</label>
          <input type="number" class="form-control" id="shoomRate" value="1000">
        </div>
        <div id="earningResults" class="table-responsive">
          <!-- ‚úÖ ‡∏¢‡πâ‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏ô -->
          <div class="fw-bold fs-5 mb-3 text-end">üí∏ ‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ: <span id="totalIncome">0</span> ‡∏ö‡∏≤‡∏ó</div>

          <table class="table table-bordered table-hover">
            <thead class="table-light text-center">
              <tr>
                <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</th>
                <th>‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ (Shoom - 200)</th>
                <th>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ (‡∏ö‡∏≤‡∏ó)</th>
              </tr>
            </thead>
            <tbody id="earningTable"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ‚úÖ Main Container -->

<div class="container py-5">
  <div class="text-center mb-5">
    <h1 class="display-5 fw-bold text-info shadow">MojiHight</h1>
  </div>

<!-- ‚úÖ Modal ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á -->
<div class="modal fade" id="deviceModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-dark">
      <div class="modal-header">
        <h5 class="modal-title">üîß ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input type="number" id="deviceNumber" class="form-control" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1, 2, 3..." min="1">
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button class="btn btn-primary" onclick="generateScript()">‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á Script</button>
      </div>
    </div>
  </div>
</div>

<!-- Account Summary -->
<div class="row text-center mb-4">
  <div class="col-md-4">
    <div class="summary-card small-card">
      <h5>Account <span class="label-online">Online</span></h5>
      <span id="online-count">0</span>
    </div>
  </div>
  <div class="col-md-4">
    <div class="summary-card small-card">
      <h5>Account <span class="label-offline">Offline</span></h5>
      <span id="offline-count">0</span>
    </div>
  </div>
  <div class="col-md-4">
    <div class="summary-card small-card">
      <h5>Total <span class="label-accounts">Accounts</span></h5>
      <span id="total-players">0</span>
    </div>
  </div>
</div>

<!-- ‚úÖ Total Items & Tokens -->
<div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3 justify-content-center">

  <!-- Shooms -->
  <div class="col">
    <div class="summary-card small-card border border-danger">
      <h5><span class="text-danger">Total Shooms</span></h5>
      <div class="fs-4 fw-bold d-flex align-items-center justify-content-center gap-2">
        <span id="shoom-total-value">0</span>
        <img src="images/shoom.png" alt="Shoom Icon" style="height: 24px;">
      </div>
    </div>
  </div>

  <!-- CreatureRevive Token -->
  <div class="col">
    <div class="summary-card small-card border border-success">
      <h5><span style="color: #7CFC00;">Total CreatureRevive Token</span></h5>
      <div class="fs-4 fw-bold d-flex align-items-center justify-content-center gap-2">
        <span id="revive-token">0</span>
        <img src="images/revive.png" alt="Revive Icon" style="height: 24px;">
      </div>
    </div>
  </div>
  
  <!-- FullGrow Token -->
  <div class="col">
    <div class="summary-card small-card border border-warning">
      <h5><span style="color: #FFD700;">Total FullGrow Token</span></h5>
      <div class="fs-4 fw-bold d-flex align-items-center justify-content-center gap-2">
        <span id="fullgrow-token">0</span>
        <img src="images/fullgrow.png" alt="FullGrow Icon" style="height: 24px;">
      </div>
    </div>
  </div>
  
  <!-- ChangeColors Token -->
  <div class="col">
    <div class="summary-card small-card border border-info">
      <h5><span style="color: #00FFFF;">Total ChangeColors Token</span></h5>
      <div class="fs-4 fw-bold d-flex align-items-center justify-content-center gap-2">
        <span id="colorchange-token">0</span>
        <img src="images/colorchange.png" alt="ColorChange Icon" style="height: 24px;">
      </div>
    </div>
  </div>
  
  <!-- PartialGrow Token -->
  <div class="col">
    <div class="summary-card small-card border border-primary">
      <h5><span style="color: #6495ED;">Total PartialGrow Token</span></h5>
      <div class="fs-4 fw-bold d-flex align-items-center justify-content-center gap-2">
        <span id="partialgrow-token">0</span>
        <img src="images/partial.png" alt="PartialGrow Icon" style="height: 24px;">
      </div>
    </div>
  </div>
  
</div>

<!-- ‚úÖ Summary Row -->
<div class="row justify-content-center mb-3 g-2">
  <div class="col-auto">
    <button class="btn btn-danger btn-glow fw-bold px-4"
            data-bs-toggle="modal" data-bs-target="#resetConfirmModal">
      üóëÔ∏è ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï Shooms ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    </button>
  </div>
  <div class="col-auto">
    <button class="btn btn-success btn-glow fw-bold px-4" onclick="copyScript()">
      üìã Get Script
    </button>
  </div>
  <div class="col-auto">
    <button class="btn btn-info btn-glow fw-bold px-4" onclick="openEarningModal()">
      üí∞ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ
    </button>
  </div>
  <div class="col-auto">
    <button class="btn btn-secondary btn-glow fw-bold px-4" onclick="openCheckPcModal()">
      üñ•Ô∏è Check PC
    </button>
  </div>
</div>
<p class="text-info mb-4 text-center" id="copyStatus"></p>

<!-- ‚úÖ Modal: Check PC -->
<div class="modal fade" id="checkPcModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content text-dark">
      <div class="modal-header">
        <h5 class="modal-title">üñ•Ô∏è ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å PC</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <!-- ‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å input-group ‡πÄ‡∏õ‡πá‡∏ô flex layout -->
        <div class="d-flex flex-wrap justify-content-center align-items-center gap-2 mb-3">
          <div id="pcCheckboxContainer" class="d-flex flex-wrap gap-2 justify-content-center"></div>
          <button class="btn btn-primary d-flex align-items-center gap-1" onclick="checkPcData()">
            üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
          </button>
        </div>
        <div id="checkPcResult" class="mt-3">
          <!-- ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ -->
        </div>
      </div>
    </div>
  </div>
</div>

  <!-- ‚úÖ Table -->
  
<div class="table-responsive card-glow">
  <table class="table table-dark table-hover table-bordered mb-0 rounded">
    <thead>
      <tr class="text-center">
        <th>#</th>
        <th>Account</th>
        <th>PC</th> <!-- ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ô‡∏µ‡πâ -->
        <th onclick="sortTableByShooms()" style="cursor: pointer;">
          Shooms ‚¨ç
        </th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody id="score-table"></tbody>
  </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
  
  let lastSortedByShooms = false;
  let sortDescending = true;
  
  function sortTableByShooms(triggerToggle = true) {
    const table = document.getElementById("score-table");
    const rows = Array.from(table.querySelectorAll("tr"));
    const header = document.querySelector("th[onclick='sortTableByShooms()']");
  
    // ‚úÖ Index ‡∏ó‡∏µ‡πà 3 ‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå Shooms
    rows.sort((a, b) => {
      const aVal = parseInt(a.children[3].innerText.replace(/,/g, '')) || 0;
      const bVal = parseInt(b.children[3].innerText.replace(/,/g, '')) || 0;
      return sortDescending ? bVal - aVal : aVal - bVal;
    });
  
    if (triggerToggle) {
      sortDescending = !sortDescending;
    }
  
    table.innerHTML = '';
    rows.forEach(row => table.appendChild(row));
  
    header.innerHTML = `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Shooms ${sortDescending ? '‚¨ç ‡∏°‡∏≤‡∏Å > ‡∏ô‡πâ‡∏≠‡∏¢' : '‚¨ç ‡∏ô‡πâ‡∏≠‡∏¢ > ‡∏°‡∏≤‡∏Å'}`;
    lastSortedByShooms = true;
  }
  
  async function fetchScores() {
    const token = localStorage.getItem('userToken');
    if (!token) return;
  
    const res = await fetch('/data', {
      method: 'POST',
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ token })
    });
  
    const data = await res.json();
    const scores = data.entries || [];
    if (!scores || scores.length === 0) return;
  
    const table = document.getElementById('score-table');
    const onlineCount = document.getElementById('online-count');
    const offlineCount = document.getElementById('offline-count');
  
    table.innerHTML = '';
    let totalScore = 0;
    let online = 0;
    let offline = 0;
  
    scores.forEach((item, i) => {
      const tr = document.createElement('tr');
    
      // ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡πÉ‡∏ô dataset ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏ß
      tr.dataset.revive = item.revive || 0;
      tr.dataset.fullgrow = item.fullgrow || 0;
      tr.dataset.colorchange = item.colorchange || 0;
      tr.dataset.partial = item.partial || 0;
    
      tr.innerHTML = `
        <td class="text-center">${i + 1}</td>
        <td>${item.player}</td>
        <td class="text-center">${item.device || '-'}</td>
        <td class="text-end">${Number(item.score).toLocaleString()}</td>
        <td class="text-center">
          ${item.online
            ? '<span class="badge bg-success pulse-online">Online</span>'
            : '<span class="badge bg-secondary pulse-offline">Offline</span>'}
        </td>
      `;
    
      table.appendChild(tr);
      totalScore += Number(item.score);
      item.online ? online++ : offline++;
    });

    animateNumber(
      document.getElementById("shoom-total-value"),
      safeParseNumber(document.getElementById("shoom-total-value").innerText),
      totalScore
    );
  
    animateNumber(
      onlineCount,
      safeParseNumber(onlineCount.innerText),
      online
    );
  
    animateNumber(
      offlineCount,
      safeParseNumber(offlineCount.innerText),
      offline
    );
  
    animateNumber(
      document.getElementById("total-players"),
      safeParseNumber(document.getElementById("total-players").innerText),
      scores.length
    );
  
    // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° Token ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ
    animateNumber(
      document.getElementById("revive-token"),
      safeParseNumber(document.getElementById("revive-token").innerText),
      data.totalRevive || 0
    );
  
    animateNumber(
      document.getElementById("fullgrow-token"),
      safeParseNumber(document.getElementById("fullgrow-token").innerText),
      data.totalFullGrow || 0
    );
  
    animateNumber(
      document.getElementById("colorchange-token"),
      safeParseNumber(document.getElementById("colorchange-token").innerText),
      data.totalColorChange || 0
    );
  
    animateNumber(
      document.getElementById("partialgrow-token"),
      safeParseNumber(document.getElementById("partialgrow-token").innerText),
      data.totalPartialGrow || 0
    );
  
    if (lastSortedByShooms) {
      sortTableByShooms(false);
    }
  }

  function animateNumber(el, start, end, duration = 800, decimals = 0) {
    const startTime = performance.now();
  
    function update(currentTime) {
      const progress = Math.min((currentTime - startTime) / duration, 1);
      const currentValue = start + (end - start) * progress;
      el.innerText = decimals > 0
        ? currentValue.toFixed(decimals)
        : Math.floor(currentValue).toLocaleString();
  
      if (progress < 1) {
        requestAnimationFrame(update);
      }
    }
  
    requestAnimationFrame(update);
  }

  function openAuthModal() {
    document.getElementById('authUsername').value = '';
    document.getElementById('authStatus').innerText = '';
    new bootstrap.Modal(document.getElementById('authModal')).show();
  }

  async function registerUser() {
    const username = document.getElementById('authUsername').value.trim();
    const status = document.getElementById('authStatus');
    if (!username) {
      status.innerText = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠";
      return;
    }

    const res = await fetch('/register', {
      method: 'POST',
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username })
    });

    const data = await res.json();
    if (res.ok) {
      localStorage.setItem("userToken", data.token);
      location.reload();
    } else {
      status.innerText = `‚ùå ${data}`;
    }
  }

  async function loginUser() {
    const username = document.getElementById('authUsername').value.trim();
    const status = document.getElementById('authStatus');
    if (!username) {
      status.innerText = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠";
      return;
    }

    const res = await fetch('/login', {
      method: 'POST',
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username })
    });

    const data = await res.json();
    if (res.ok) {
      localStorage.setItem("userToken", data.token);
      location.reload();
    } else {
      status.innerText = `‚ùå ${data}`;
    }
  }

    function logout() {
    localStorage.removeItem('userToken');
    checkLogin(); // ‡πÅ‡∏ó‡∏ô location.reload()
    }

    async function checkLogin() {
    const token = localStorage.getItem('userToken');
    const nav = document.getElementById('user-nav');

    if (!token) {
        // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏° Login ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ Login
        nav.innerHTML = `
        <button class="btn btn-outline-light btn-sm" onclick="openAuthModal()">üéüÔ∏è Register / Login</button>
        `;
        return;
    }

    const res = await fetch('/me', {
        method: 'POST',
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ token })
    });

    if (!res.ok) {
        // ‚úÖ Token ‡∏ú‡∏¥‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏° Login ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
        localStorage.removeItem("userToken");
        nav.innerHTML = `
        <button class="btn btn-outline-light btn-sm" onclick="openAuthModal()">üéüÔ∏è Register / Login</button>
        `;
        return;
    }

    const data = await res.json();
    nav.innerHTML = `
        üë§ <strong>${data.username}</strong>
        <button class="btn btn-warning btn-sm ms-2" onclick="showToken()">üîë Token</button>
        <button class="btn btn-outline-danger btn-sm ms-2" onclick="logout()">üö™ Logout</button>
    `;
    }

    function showToken() {
    const token = localStorage.getItem('userToken');
    if (!token) {
        alert("‡πÑ‡∏°‡πà‡∏û‡∏ö Token");
        return;
    }

    document.getElementById('tokenValue').innerText = token;
    new bootstrap.Modal(document.getElementById('tokenModal')).show();
    }

    async function confirmResetScores() {
      const token = localStorage.getItem("userToken");
      if (!token) {
        alert("‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ Login");
        return;
      }
    
      // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï
      document.getElementById("shoom-total-value").innerText = '‚ôªÔ∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï...';
    
      try {
        const res = await fetch('/reset', {
          method: 'POST',
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ token })
        });
    
        if (!res.ok) {
          throw new Error("‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        }
    
        // ‡∏•‡πâ‡∏≤‡∏á UI ‡∏ó‡∏∏‡∏Å‡∏à‡∏∏‡∏î
        document.getElementById("score-table").innerHTML = '';
        document.getElementById("shoom-total-value").innerText = '0';
        document.getElementById("online-count").innerText = '0';
        document.getElementById("offline-count").innerText = '0';
        document.getElementById("total-players").innerText = '0';
        document.getElementById("revive-token").innerText = '0';
        document.getElementById("fullgrow-token").innerText = '0';
        document.getElementById("colorchange-token").innerText = '0';
        document.getElementById("partialgrow-token").innerText = '0';
    
        // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏ß‡∏£‡πå
        await fetchScores();
    
        // ‡∏õ‡∏¥‡∏î modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('resetConfirmModal'));
        modal.hide();
      } catch (error) {
        console.error("‚ùå Reset failed:", error);
        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï Shooms");
      }
    }

  fetchScores();
  setInterval(fetchScores, 60000);
  checkLogin();

  document.getElementById("shoomRate").addEventListener("input", updateEarningTable);

  function copyScript() {
    const token = localStorage.getItem("userToken");
    if (!token) {
      document.getElementById("copyStatus").innerText = "‚ùó ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ Login ‡∏Å‡πà‡∏≠‡∏ô!";
      return;
    }
  
    // ‡πÄ‡∏õ‡∏¥‡∏î modal ‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
    const modal = new bootstrap.Modal(document.getElementById('deviceModal'));
    modal.show();
  }

  function generateScript() {
    const token = localStorage.getItem("userToken");
    const device = document.getElementById("deviceNumber").value.trim();
  
    if (!device || isNaN(device)) {
      alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
      return;
    }
  
    const script = `
  getgenv().token = "${token}"
  getgenv().device = "${device}"
  loadstring(game:HttpGet("https://raw.githubusercontent.com/SitXz120/LOG/main/public/script.lua"))()
    `.trim();
  
    navigator.clipboard.writeText(script).then(() => {
      bootstrap.Modal.getInstance(document.getElementById("deviceModal")).hide();
      const modal = new bootstrap.Modal(document.getElementById('getScriptModal'));
      modal.show();
    }).catch(() => {
      document.getElementById("copyStatus").innerText = "‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏î‡πâ";
    });
  }
  
  const audio = document.getElementById('bgMusic');
  const volumeSlider = document.getElementById('musicVolume');
  
  // üéµ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏ö‡∏≤‡πÅ‡∏ö‡∏ö‡∏Å‡∏•‡∏∑‡∏ô‡πÜ (10%)
  audio.volume = 0.1;
  volumeSlider.value = 0.1;
  
  // üåÄ Sync slider ‡∏Å‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á
  volumeSlider.addEventListener('input', () => {
    audio.volume = volumeSlider.value;
  });
  
  // Toggle play/pause
  function toggleMusic() {
    if (audio.paused) {
      audio.play();
    } else {
      audio.pause();
    }
  }
  
  // Close popup
  function closeMusicPopup() {
    document.getElementById('music-control').style.display = 'none';
    audio.pause();
  }

  document.addEventListener("click", () => {
    try {
      audio.play();
    } catch (e) {
      console.warn("Autoplay failed:", e);
    }
  }, { once: true });

  function updateEarningTable() {
    const rate = parseFloat(document.getElementById("shoomRate").value) || 1000;
    const tableBody = document.getElementById("score-table");
    const rows = Array.from(tableBody.querySelectorAll("tr"));
    const earningTable = document.getElementById("earningTable");
    const totalIncomeEl = document.getElementById("totalIncome");

    let totalIncome = 0;
    earningTable.innerHTML = '';

    rows.forEach(row => {
      const player = row.children[1].innerText;
      const rawShoom = parseInt(row.children[3].innerText.replace(/,/g, '')) || 0;
      const usable = Math.max(rawShoom - 200, 0);
      const income = usable / rate;

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${player}</td>
        <td class="text-end">${usable.toLocaleString()}</td>
        <td class="text-end">${income.toFixed(2)} ‡∏ö‡∏≤‡∏ó</td>
      `;
      earningTable.appendChild(tr);
      totalIncome += income;
    });

    animateNumber(
      totalIncomeEl,
      safeParseNumber(totalIncomeEl.innerText),
      totalIncome,
      800,
      2
    );
  }

  function openEarningModal() {
    updateEarningTable(); // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡πà‡∏≠‡∏ô
    const modal = new bootstrap.Modal(document.getElementById('earningModal'));
    modal.show(); // ‡πÄ‡∏õ‡∏¥‡∏î modal ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
  }
  function safeParseNumber(text) {
    return parseFloat(text.replace(/[^0-9.-]+/g, "")) || 0;
  }

  function openCheckPcModal() {
    const devices = new Set();
    document.querySelectorAll("#score-table tr").forEach(row => {
      const device = row.children[2]?.innerText.trim();
      if (device && device !== '-') devices.add(device);
    });
  
    const container = document.getElementById("pcCheckboxContainer");
    container.innerHTML = '';
    
    [...devices].sort((a, b) => a - b).forEach(num => {
      const label = document.createElement("label");
      label.className = "form-check"; // ‡πÉ‡∏ä‡πâ label ‡πÅ‡∏ó‡∏ô div
      label.innerHTML = `
        <input class="form-check-input" type="checkbox" value="${num}" id="pc${num}">
        <span class="form-check-label">PC ${num}</span>
      `;
      container.appendChild(label);
    });
  
    document.getElementById("checkPcResult").innerHTML = '';
    new bootstrap.Modal(document.getElementById('checkPcModal')).show();
  }
  
  function checkPcData() {
    const checked = [...document.querySelectorAll("#pcCheckboxContainer input:checked")]
      .map(input => input.value);
  
    if (checked.length === 0) {
      alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç PC ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö");
      return;
    }
  
    const rows = Array.from(document.querySelectorAll("#score-table tr"));
    const result = {
      shooms: 0,
      online: 0,
      offline: 0,
      total: 0,
      revive: 0,
      fullgrow: 0,
      colorchange: 0,
      partial: 0
    };
  
    let summaryHtml = ``;
    let tableRows = ``;
  
    rows.forEach(row => {
      const device = row.children[2].innerText.trim();
      if (!checked.includes(device)) return;
  
      const score = parseInt(row.children[3].innerText.replace(/,/g, '')) || 0;
      const isOnline = row.children[4].innerText.includes("Online");
      const player = row.children[1].innerText;
      const revive = parseInt(row.dataset.revive || 0);
      const fullgrow = parseInt(row.dataset.fullgrow || 0);
      const colorchange = parseInt(row.dataset.colorchange || 0);
      const partial = parseInt(row.dataset.partial || 0);
  
      result.total++;
      result.shooms += score;
      isOnline ? result.online++ : result.offline++;
      result.revive += revive;
      result.fullgrow += fullgrow;
      result.colorchange += colorchange;
      result.partial += partial;
  
      tableRows += `
        <tr class="text-center">
          <td>${player}</td>
          <td>${score.toLocaleString()}</td>
          <td>${isOnline ? "‚úÖ Online" : "‚ùå Offline"}</td>
        </tr>
      `;
    });
  
    summaryHtml = `
      <div class="text-end mb-3">
        <p><strong>üìä ‡∏£‡∏ß‡∏°:</strong></p>
        <p>Total Shooms: ${result.shooms.toLocaleString()}</p>
        <p>Total Accounts: ${result.total}</p>
        <p>Online: ${result.online} | Offline: ${result.offline}</p>
      </div>
    `;
  
    const tableHtml = `
      ${summaryHtml}
      <div class="table-responsive">
        <table class="table table-dark table-bordered table-hover">
          <thead class="table-light text-center">
            <tr>
              <th>Player</th>
              <th>Shooms</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            ${tableRows}
          </tbody>
        </table>
      </div>
    `;
  
    document.getElementById("checkPcResult").innerHTML = tableHtml;
  }

</script>

</body>
</html>
