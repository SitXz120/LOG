<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Moji Leaderboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(to bottom, #0f0f0f, #1a1a1a);
      color: white;
      font-family: 'Segoe UI', sans-serif;
    }

```
.card-glow {
  box-shadow: 0 4px 20px rgba(0, 255, 204, 0.1);
  border-radius: 1rem;
  border: none;
}

.table th, .table td {
  vertical-align: middle;
}

.btn-glow {
  box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
}
```

  </style>
</head>
<body>

<!-- âœ… Navbar -->

<nav class="navbar navbar-dark bg-dark shadow px-3 justify-content-between">
  <a href="/" class="navbar-brand fw-bold">ğŸŒ Moji Leaderboard</a>
  <div id="user-nav">
    <!-- à¸›à¸¸à¹ˆà¸¡à¸ˆà¸°à¸–à¸¹à¸à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹‚à¸”à¸¢ JS -->
  </div>
</nav>

<!-- âœ… Modal -->

<div class="modal fade" id="tokenModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-dark">
      <div class="modal-header">
        <h5 class="modal-title">ğŸ”‘ Token à¸‚à¸­à¸‡à¸„à¸¸à¸“</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-center">
        <p class="fw-bold" id="tokenValue"></p>
      </div>
    </div>
  </div>
</div>

<!-- âœ… Modal Register/Login -->

<div class="modal fade" id="authModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-dark">
      <div class="modal-header">
        <h5 class="modal-title">ğŸŸï¸ à¸ªà¸¡à¸±à¸„à¸£ / Login</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-center">
        <input type="text" id="authUsername" class="form-control mb-3" placeholder="à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸‚à¸­à¸‡à¸„à¸¸à¸“">
        <button class="btn btn-success mb-2 w-100" onclick="registerUser()">âœ… à¸ªà¸¡à¸±à¸„à¸£à¹ƒà¸«à¸¡à¹ˆ</button>
        <button class="btn btn-primary w-100" onclick="loginUser()">ğŸ” Login</button>
        <p class="mt-3 text-danger fw-bold" id="authStatus"></p>
      </div>
    </div>
  </div>
</div>

<!-- âœ… Main Container -->

<div class="container py-5">
  <div class="text-center mb-5">
    <h1 class="display-5 fw-bold text-info shadow">ğŸ“Š Leaderboard</h1>
  </div>

  <!-- âœ… Online/Offline Summary -->

  <div class="row text-center mb-4">
    <div class="col">
      <div class="alert alert-info fw-bold fs-5 shadow">ğŸŸ¢ à¸­à¸­à¸™à¹„à¸¥à¸™à¹Œ: <span id="online-count">0</span> à¸„à¸™</div>
    </div>
    <div class="col">
      <div class="alert alert-secondary fw-bold fs-5 shadow">ğŸ”´ à¸­à¸­à¸Ÿà¹„à¸¥à¸™à¹Œ: <span id="offline-count">0</span> à¸„à¸™</div>
    </div>
  </div>

  <!-- âœ… Summary Row -->

  <div class="row mb-4">
    <div class="col-md-4 text-start">
      <button class="btn btn-danger btn-glow fw-bold w-100" onclick="resetScores()">ğŸ—‘ï¸ à¸£à¸µà¹€à¸‹à¹‡à¸• Shooms à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”</button>
    </div>
    <div class="col-md-4 text-center">
      <div class="alert alert-success fw-bold fs-5 mb-0 shadow" id="total">
        ğŸ’° à¸£à¸§à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”: 0 Shooms
      </div>
    </div>
    <div class="col-md-4 text-end">
      <button class="btn btn-success fw-bold w-100" onclick="copyScript()">ğŸ“‹ Get Script</button>
      <p class="text-info mt-2 mb-0" id="copyStatus"></p>
    </div>
  </div>

  <!-- âœ… Table -->

  <div class="table-responsive card-glow">
    <table class="table table-dark table-hover table-bordered mb-0 rounded">
      <thead>
        <tr class="text-center">
          <th>#</th>
          <th>à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹€à¸¥à¹ˆà¸™</th>
          <th>à¸ˆà¸³à¸™à¸§à¸™ Shooms</th>
          <th>à¸ªà¸–à¸²à¸™à¸°</th>
        </tr>
      </thead>
      <tbody id="score-table"></tbody>
    </table>
  </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    async function fetchScores() {
    const token = localStorage.getItem('userToken');
    if (!token) return;

    const res = await fetch('/data', {
        method: 'POST',
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ token })
    });

    const scores = await res.json();
    if (!scores || scores.length === 0) return;

    const table = document.getElementById('score-table');
    const total = document.getElementById('total');
    const onlineCount = document.getElementById('online-count');
    const offlineCount = document.getElementById('offline-count');

    table.innerHTML = '';
    let totalScore = 0;
    let online = 0;
    let offline = 0;

    scores.forEach((item, i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
        <td class="text-center">${i + 1}</td>
        <td>${item.player}</td>
        <td class="text-end">${Number(item.score).toLocaleString()}</td>
        <td class="text-center">
            ${item.online
            ? '<span class="badge bg-success">à¸­à¸­à¸™à¹„à¸¥à¸™à¹Œ</span>'
            : '<span class="badge bg-secondary">à¸­à¸­à¸Ÿà¹„à¸¥à¸™à¹Œ</span>'}
        </td>
        `;
        table.appendChild(tr);
        totalScore += Number(item.score);
        item.online ? online++ : offline++;
    });

    total.innerText = `ğŸ’° à¸£à¸§à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”: ${totalScore.toLocaleString()} Shooms`;
    onlineCount.innerText = online;
    offlineCount.innerText = offline;
    }

  function openAuthModal() {
    document.getElementById('authUsername').value = '';
    document.getElementById('authStatus').innerText = '';
    new bootstrap.Modal(document.getElementById('authModal')).show();
  }

  async function registerUser() {
    const username = document.getElementById('authUsername').value.trim();
    const status = document.getElementById('authStatus');
    if (!username) {
      status.innerText = "à¸à¸£à¸¸à¸“à¸²à¹ƒà¸ªà¹ˆà¸Šà¸·à¹ˆà¸­";
      return;
    }

    const res = await fetch('/register', {
      method: 'POST',
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username })
    });

    const data = await res.json();
    if (res.ok) {
      localStorage.setItem("userToken", data.token);
      location.reload();
    } else {
      status.innerText = `âŒ ${data}`;
    }
  }

  async function loginUser() {
    const username = document.getElementById('authUsername').value.trim();
    const status = document.getElementById('authStatus');
    if (!username) {
      status.innerText = "à¸à¸£à¸¸à¸“à¸²à¹ƒà¸ªà¹ˆà¸Šà¸·à¹ˆà¸­";
      return;
    }

    const res = await fetch('/login', {
      method: 'POST',
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username })
    });

    const data = await res.json();
    if (res.ok) {
      localStorage.setItem("userToken", data.token);
      location.reload();
    } else {
      status.innerText = `âŒ ${data}`;
    }
  }

    function logout() {
    localStorage.removeItem('userToken');
    checkLogin(); // à¹à¸—à¸™ location.reload()
    }

    async function checkLogin() {
    const token = localStorage.getItem('userToken');
    const nav = document.getElementById('user-nav');

    if (!token) {
        // âœ… à¹à¸ªà¸”à¸‡à¸›à¸¸à¹ˆà¸¡ Login à¸–à¹‰à¸²à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹„à¸”à¹‰ Login
        nav.innerHTML = `
        <button class="btn btn-outline-light btn-sm" onclick="openAuthModal()">ğŸŸï¸ Register / Login</button>
        `;
        return;
    }

    const res = await fetch('/me', {
        method: 'POST',
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ token })
    });

    if (!res.ok) {
        // âœ… Token à¸œà¸´à¸”à¸«à¸£à¸·à¸­à¸«à¸¡à¸”à¸­à¸²à¸¢à¸¸ â†’ à¹à¸ªà¸”à¸‡à¸›à¸¸à¹ˆà¸¡ Login à¸­à¸µà¸à¸„à¸£à¸±à¹‰à¸‡
        localStorage.removeItem("userToken");
        nav.innerHTML = `
        <button class="btn btn-outline-light btn-sm" onclick="openAuthModal()">ğŸŸï¸ Register / Login</button>
        `;
        return;
    }

    const data = await res.json();
    nav.innerHTML = `
        ğŸ‘¤ <strong>${data.username}</strong>
        <button class="btn btn-warning btn-sm ms-2" onclick="showToken()">ğŸ”‘ Token</button>
        <button class="btn btn-outline-danger btn-sm ms-2" onclick="logout()">ğŸšª Logout</button>
    `;
    }

    function showToken() {
    const token = localStorage.getItem('userToken');
    if (!token) {
        alert("à¹„à¸¡à¹ˆà¸à¸š Token");
        return;
    }

    document.getElementById('tokenValue').innerText = token;
    new bootstrap.Modal(document.getElementById('tokenModal')).show();
    }

    async function resetScores() {
    const confirmReset = confirm("âš ï¸ à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸£à¸µà¹€à¸‹à¹‡à¸• Shooms à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?");
    if (!confirmReset) return;

    const token = localStorage.getItem("userToken");
    if (!token) {
        alert("à¸„à¸¸à¸“à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹„à¸”à¹‰ Login");
        return;
    }

    const res = await fetch('/reset', {
        method: 'POST',
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ token })
    });

    if (res.ok) {
        fetchScores(); // à¸£à¸µà¹‚à¸«à¸¥à¸”à¹ƒà¸«à¸¡à¹ˆ
    } else {
        alert("à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¸£à¸µà¹€à¸‹à¹‡à¸• Shooms");
    }
    }

  fetchScores();
  setInterval(fetchScores, 3000);
  checkLogin();

  function copyScript() {
    const token = localStorage.getItem("userToken");
    if (!token) {
      document.getElementById("copyStatus").innerText = "â— à¸à¸£à¸¸à¸“à¸² Login à¸à¹ˆà¸­à¸™!";
      return;
    }
  
    const script = `
  getgenv().token = "${token}"
  loadstring(game:HttpGet("https://raw.githubusercontent.com/yourusername/yourrepo/main/script.lua"))()
    `.trim();
  
    navigator.clipboard.writeText(script).then(() => {
      document.getElementById("copyStatus").innerText = "âœ… à¸„à¸±à¸”à¸¥à¸­à¸à¸ªà¸„à¸£à¸´à¸›à¸•à¹Œà¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢à¹à¸¥à¹‰à¸§!";
    }).catch(() => {
      document.getElementById("copyStatus").innerText = "âŒ à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸„à¸±à¸”à¸¥à¸­à¸à¹„à¸”à¹‰";
    });
  }
  
</script>

</body>
</html>
