<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Moji Leaderboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
      body {
        background: linear-gradient(to bottom, #0f0f0f, #1a1a1a);
        color: white;
        font-family: 'Segoe UI', sans-serif;
      }
      
      .card-glow {
        box-shadow: 0 4px 20px rgba(0, 255, 204, 0.1);
        border-radius: 1rem;
        border: none;
      }
      
      .table th, .table td {
        vertical-align: middle;
      }
      
      .btn-glow {
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        transition: transform 0.2s ease, box-shadow 0.3s ease;
      }
      .btn-glow:hover {
        transform: translateY(-3px);
        box-shadow: 0 0 18px rgba(0, 255, 204, 0.5);
      }
      
      .display-5 {
        animation: fadeInDown 1s ease-out;
      }
      @keyframes fadeInDown {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes pulseGreen {
        0%, 100% { box-shadow: 0 0 4px rgba(0, 255, 100, 0.3); }
        50% { box-shadow: 0 0 8px rgba(0, 255, 100, 0.5); }
      }
      
      @keyframes pulseGray {
        0%, 100% { box-shadow: 0 0 3px rgba(150, 150, 150, 0.15); }
        50% { box-shadow: 0 0 6px rgba(150, 150, 150, 0.3); }
      }
      .pulse-online {
        animation: pulseGreen 1.5s infinite;
      }
      
      .pulse-offline {
        animation: pulseGray 1.5s infinite;
      }
      .badge.pulse-online, .badge.pulse-offline {
        border-radius: 30px;
        padding: 0.5em 1em;
        font-weight: bold;
        color: #fff;
        background-color: transparent;
        position: relative;
        z-index: 1;
      }
      
      .badge.pulse-online::before,
      .badge.pulse-offline::before {
        content: "";
        position: absolute;
        top: -4px; left: -10px; right: -10px; bottom: -4px;
        border-radius: 40px;
        z-index: -1;
        filter: blur(6px);
      }      
      .badge.pulse-online::before {
        background: rgba(0, 255, 100, 0.25);
        animation: pulseGreen 1.5s infinite;
      }
      
      .badge.pulse-offline::before {
        background: rgba(150, 150, 150, 0.15);
        animation: pulseGray 1.5s infinite;
      }
      .alert-soft {
        background-color: rgba(255, 255, 255, 0.05); /* ‡∏ó‡∏∂‡∏ö‡∏•‡∏á */
        color: #fff;
        border: 1px solid rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(3px);
        border-radius: 12px;
      }
      #bgVideo {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        object-fit: cover;
        z-index: -10;
        opacity: 0.15; /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™ */
        pointer-events: none; /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏á UI */
        filter: blur(1px); /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∞‡∏°‡∏∏‡∏ô */
      }
      .music-popup {
        position: fixed;
        bottom: 20px;
        left: 20px;
        background: rgba(0, 0, 0, 0.5);
        padding: 10px 12px;
        border-radius: 10px;
        z-index: 99;
        display: flex;
        align-items: center;
        gap: 10px;
        backdrop-filter: blur(4px);
        box-shadow: 0 0 10px rgba(0,255,204,0.2);
      }
      .music-popup button {
        background: none;
        border: none;
        color: #fff;
        font-size: 20px;
        cursor: pointer;
      }
      .music-popup input[type="range"] {
        width: 100px;
      }
    
  </style>
</head>
<body>
  
<!-- üé¨ Video Background -->
<video autoplay muted loop playsinline id="bgVideo">
  <source src="videos/moji-bg.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>

<!-- üéµ Music Player -->
<div id="music-control" class="music-popup">
  <audio id="bgMusic" src="audio/music.mp3" loop></audio>
  <button onclick="toggleMusic()">‚èØÔ∏è</button>
  <input type="range" id="musicVolume" min="0" max="1" step="0.01" value="0.1">
  <button onclick="closeMusicPopup()">‚ùå</button>
</div>
  
<!-- ‚úÖ Navbar -->

<nav class="navbar navbar-dark bg-dark shadow px-3 justify-content-between">
  <a href="/" class="navbar-brand fw-bold">üåê Moji Leaderboard</a>
  <div id="user-nav">
    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÇ‡∏î‡∏¢ JS -->
  </div>
</nav>

<!-- ‚úÖ Modal -->

<div class="modal fade" id="tokenModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-dark">
      <div class="modal-header">
        <h5 class="modal-title">üîë Token ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-center">
        <p class="fw-bold" id="tokenValue"></p>
      </div>
    </div>
  </div>
</div>

  <!-- ‚úÖ Modal Get Script Success -->
<div class="modal fade" id="getScriptModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-dark">
      <div class="modal-header">
        <h5 class="modal-title">üìã Script Ready!</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p>‚úÖ Token ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏ù‡∏±‡∏á‡πÉ‡∏ô Script ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</p>
        <p class="mb-0"><strong>üìå ‡∏ß‡∏≤‡∏á‡∏•‡∏á‡πÉ‡∏ô Executor ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</strong></p>
      </div>
    </div>
  </div>
</div>

<!-- ‚úÖ Modal Reset Confirm -->
<div class="modal fade" id="resetConfirmModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-dark">
      <div class="modal-header">
        <h5 class="modal-title">‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï Shooms ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button class="btn btn-danger" onclick="confirmResetScores()">üóëÔ∏è ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏•‡∏¢!</button>
      </div>
    </div>
  </div>
</div>


<!-- ‚úÖ Modal Register/Login -->

<div class="modal fade" id="authModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-dark">
      <div class="modal-header">
        <h5 class="modal-title">üéüÔ∏è ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ / Login</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-center">
        <input type="text" id="authUsername" class="form-control mb-3" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
        <button class="btn btn-success mb-2 w-100" onclick="registerUser()">‚úÖ ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏´‡∏°‡πà</button>
        <button class="btn btn-primary w-100" onclick="loginUser()">üîê Login</button>
        <p class="mt-3 text-danger fw-bold" id="authStatus"></p>
      </div>
    </div>
  </div>
</div>

<!-- üí∏ Modal ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ -->
<div class="modal fade" id="earningModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content text-dark">
      <div class="modal-header">
        <h5 class="modal-title">üí∞ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å Shoom</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label">üìâ ‡πÄ‡∏£‡∏ó Shoom ‡∏ï‡πà‡∏≠ 1 ‡∏ö‡∏≤‡∏ó:</label>
          <input type="number" class="form-control" id="shoomRate" value="1000">
        </div>
        <div id="earningResults" class="table-responsive">
          <!-- ‚úÖ ‡∏¢‡πâ‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏ô -->
          <div class="fw-bold fs-5 mb-3 text-end">üí∏ ‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ: <span id="totalIncome">0</span> ‡∏ö‡∏≤‡∏ó</div>

          <table class="table table-bordered table-hover">
            <thead class="table-light text-center">
              <tr>
                <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</th>
                <th>‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ (Shoom - 200)</th>
                <th>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ (‡∏ö‡∏≤‡∏ó)</th>
              </tr>
            </thead>
            <tbody id="earningTable"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ‚úÖ Main Container -->

<div class="container py-5">
  <div class="text-center mb-5">
    <h1 class="display-5 fw-bold text-info shadow">üìä Moji Manager Tools</h1>
  </div>

  <!-- ‚úÖ Online/Offline Summary -->

  <div class="row text-center mb-4">
    <div class="col">
      <div class="alert alert-soft fw-bold fs-5 shadow">
        üü¢ ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå: <span id="online-count">0</span> ‡∏Ñ‡∏ô
      </div>
    </div>
    <div class="col">
      <div class="alert alert-soft fw-bold fs-5 shadow">
        üî¥ ‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå: <span id="offline-count">0</span> ‡∏Ñ‡∏ô
      </div>
    </div>
    <div class="col">
      <div class="alert alert-soft fw-bold fs-5 shadow">
        üë• ‡πÑ‡∏≠‡∏î‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <span id="total-players">0</span> ‡πÑ‡∏≠‡∏î‡∏µ
      </div>
    </div>
  </div>

  <!-- ‚úÖ Summary Row -->

  <div class="row mb-4">
    <div class="col-md-4 text-start">
      <button class="btn btn-danger btn-glow fw-bold w-100"
              data-bs-toggle="modal" data-bs-target="#resetConfirmModal">
        üóëÔ∏è ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï Shooms ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
      </button>
    </div>
    <div class="col-md-4 text-center">
      <div class="alert alert-success fw-bold fs-5 mb-0 shadow" id="total">
        üí∞ ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: 0 Shooms
      </div>
    </div>
    <div class="col-md-4 text-end">
      <button class="btn btn-success btn-glow fw-bold w-100 position-relative" onclick="copyScript()">
        üìã Get Script
      </button>
      <p class="text-info mt-2 mb-0" id="copyStatus"></p>
    </div>
    <!-- ‡∏¢‡πâ‡∏≤‡∏¢‡∏õ‡∏∏‡πà‡∏°‡∏ô‡∏µ‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏ô row -->
    <div class="col-12 mt-3">
      <button class="btn btn-info btn-glow fw-bold w-100" onclick="openEarningModal()">
        üí∞ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ
      </button>
    </div>
  </div>

  <!-- ‚úÖ Table -->
  
<div class="table-responsive card-glow">
  <table class="table table-dark table-hover table-bordered mb-0 rounded">
    <thead>
      <tr class="text-center">
        <th>#</th>
        <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</th>
        <th>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</th> <!-- ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ô‡∏µ‡πâ -->
        <th onclick="sortTableByShooms()" style="cursor: pointer;">
          ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Shooms ‚¨ç
        </th>
        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
      </tr>
    </thead>
    <tbody id="score-table"></tbody>
  </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
  
  let lastSortedByShooms = false;
  let sortDescending = true;
  
  function sortTableByShooms(triggerToggle = true) {
    const table = document.getElementById("score-table");
    const rows = Array.from(table.querySelectorAll("tr"));
    const header = document.querySelector("th[onclick='sortTableByShooms()']");
  
    rows.sort((a, b) => {
      const aVal = parseInt(a.children[2].innerText.replace(/,/g, ''));
      const bVal = parseInt(b.children[2].innerText.replace(/,/g, ''));
      return sortDescending ? bVal - aVal : aVal - bVal;
    });
  
    if (triggerToggle) {
      sortDescending = !sortDescending;
    }
  
    table.innerHTML = '';
    rows.forEach(row => table.appendChild(row));
  
    header.innerHTML = `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Shooms ${sortDescending ? 'üîΩ' : 'üîº'}`;
    lastSortedByShooms = true;
  }
  
  async function fetchScores() {
    const token = localStorage.getItem('userToken');
    if (!token) return;
  
    const res = await fetch('/data', {
      method: 'POST',
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ token })
    });
  
    const scores = await res.json();
    if (!scores || scores.length === 0) return;
  
    const table = document.getElementById('score-table');
    const total = document.getElementById('total');
    const onlineCount = document.getElementById('online-count');
    const offlineCount = document.getElementById('offline-count');
  
    table.innerHTML = '';
    let totalScore = 0;
    let online = 0;
    let offline = 0;
  
    scores.forEach((item, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="text-center">${i + 1}</td>
        <td>${item.player}</td>
        <td class="text-center">${item.device || '-'}</td> <!-- ‚úÖ ‡πÉ‡∏™‡πà‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á -->
        <td class="text-end">${Number(item.score).toLocaleString()}</td>
        <td class="text-center">
          ${item.online
            ? '<span class="badge bg-success pulse-online">‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</span>'
            : '<span class="badge bg-secondary pulse-offline">‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå</span>'}
        </td>
      `;
      table.appendChild(tr);
      totalScore += Number(item.score);
      item.online ? online++ : offline++;
    });
  
    total.innerText = `üí∞ ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalScore.toLocaleString()} Shooms`;
    onlineCount.innerText = online;
    offlineCount.innerText = offline;
    document.getElementById('total-players').innerText = scores.length;
  
    if (lastSortedByShooms) {
      sortTableByShooms(false);
    }
  }

  function openAuthModal() {
    document.getElementById('authUsername').value = '';
    document.getElementById('authStatus').innerText = '';
    new bootstrap.Modal(document.getElementById('authModal')).show();
  }

  async function registerUser() {
    const username = document.getElementById('authUsername').value.trim();
    const status = document.getElementById('authStatus');
    if (!username) {
      status.innerText = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠";
      return;
    }

    const res = await fetch('/register', {
      method: 'POST',
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username })
    });

    const data = await res.json();
    if (res.ok) {
      localStorage.setItem("userToken", data.token);
      location.reload();
    } else {
      status.innerText = `‚ùå ${data}`;
    }
  }

  async function loginUser() {
    const username = document.getElementById('authUsername').value.trim();
    const status = document.getElementById('authStatus');
    if (!username) {
      status.innerText = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠";
      return;
    }

    const res = await fetch('/login', {
      method: 'POST',
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username })
    });

    const data = await res.json();
    if (res.ok) {
      localStorage.setItem("userToken", data.token);
      location.reload();
    } else {
      status.innerText = `‚ùå ${data}`;
    }
  }

    function logout() {
    localStorage.removeItem('userToken');
    checkLogin(); // ‡πÅ‡∏ó‡∏ô location.reload()
    }

    async function checkLogin() {
    const token = localStorage.getItem('userToken');
    const nav = document.getElementById('user-nav');

    if (!token) {
        // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏° Login ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ Login
        nav.innerHTML = `
        <button class="btn btn-outline-light btn-sm" onclick="openAuthModal()">üéüÔ∏è Register / Login</button>
        `;
        return;
    }

    const res = await fetch('/me', {
        method: 'POST',
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ token })
    });

    if (!res.ok) {
        // ‚úÖ Token ‡∏ú‡∏¥‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏° Login ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
        localStorage.removeItem("userToken");
        nav.innerHTML = `
        <button class="btn btn-outline-light btn-sm" onclick="openAuthModal()">üéüÔ∏è Register / Login</button>
        `;
        return;
    }

    const data = await res.json();
    nav.innerHTML = `
        üë§ <strong>${data.username}</strong>
        <button class="btn btn-warning btn-sm ms-2" onclick="showToken()">üîë Token</button>
        <button class="btn btn-outline-danger btn-sm ms-2" onclick="logout()">üö™ Logout</button>
    `;
    }

    function showToken() {
    const token = localStorage.getItem('userToken');
    if (!token) {
        alert("‡πÑ‡∏°‡πà‡∏û‡∏ö Token");
        return;
    }

    document.getElementById('tokenValue').innerText = token;
    new bootstrap.Modal(document.getElementById('tokenModal')).show();
    }

    async function confirmResetScores() {
      const token = localStorage.getItem("userToken");
      if (!token) {
        alert("‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ Login");
        return;
      }
    
      // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï
      document.getElementById("total").innerText = '‚ôªÔ∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï...';
    
      const res = await fetch('/reset', {
        method: 'POST',
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ token })
      });
    
      if (res.ok) {
        document.getElementById("score-table").innerHTML = '';
        document.getElementById("total").innerText = 'üí∞ ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: 0 Shooms';
        document.getElementById("online-count").innerText = '0';
        document.getElementById("offline-count").innerText = '0';
    
        // ‚úÖ ‡∏õ‡∏¥‡∏î Modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('resetConfirmModal'));
        modal.hide();
      } else {
        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï Shooms");
      }
    }

  fetchScores();
  setInterval(fetchScores, 10000);
  checkLogin();

  function copyScript() {
    const token = localStorage.getItem("userToken");
    if (!token) {
      document.getElementById("copyStatus").innerText = "‚ùó ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ Login ‡∏Å‡πà‡∏≠‡∏ô!";
      return;
    }
  
    const device = prompt("üîß ‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ (‡πÄ‡∏ä‡πà‡∏ô 1, 2, 3...):", "1") || "1";
  
    const script = `
  getgenv().token = "${token}"
  getgenv().device = "${device}"
  loadstring(game:HttpGet("https://raw.githubusercontent.com/SitXz120/LOG/main/public/script.lua"))()
    `.trim();
  
    navigator.clipboard.writeText(script).then(() => {
      const modal = new bootstrap.Modal(document.getElementById('getScriptModal'));
      modal.show();
    }).catch(() => {
      document.getElementById("copyStatus").innerText = "‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏î‡πâ";
    });
  }

  const audio = document.getElementById('bgMusic');
  const volumeSlider = document.getElementById('musicVolume');
  
  // üéµ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏ö‡∏≤‡πÅ‡∏ö‡∏ö‡∏Å‡∏•‡∏∑‡∏ô‡πÜ (10%)
  audio.volume = 0.1;
  volumeSlider.value = 0.1;
  
  // üåÄ Sync slider ‡∏Å‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á
  volumeSlider.addEventListener('input', () => {
    audio.volume = volumeSlider.value;
  });
  
  // Toggle play/pause
  function toggleMusic() {
    if (audio.paused) {
      audio.play();
    } else {
      audio.pause();
    }
  }
  
  // Close popup
  function closeMusicPopup() {
    document.getElementById('music-control').style.display = 'none';
    audio.pause();
  }

  document.addEventListener("click", () => {
    try {
      audio.play();
    } catch (e) {
      console.warn("Autoplay failed:", e);
    }
  }, { once: true });

  function updateEarningTable() {
    const rate = parseFloat(document.getElementById("shoomRate").value) || 1000;
    const tableBody = document.getElementById("score-table");
    const rows = Array.from(tableBody.querySelectorAll("tr"));
    const earningTable = document.getElementById("earningTable");
    const totalIncomeEl = document.getElementById("totalIncome");

    let totalIncome = 0;
    earningTable.innerHTML = '';

    rows.forEach(row => {
      const player = row.children[1].innerText;
      const rawShoom = parseInt(row.children[2].innerText.replace(/,/g, '')) || 0;
      const usable = Math.max(rawShoom - 200, 0);
      const income = usable / rate;

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${player}</td>
        <td class="text-end">${usable.toLocaleString()}</td>
        <td class="text-end">${income.toFixed(2)} ‡∏ö‡∏≤‡∏ó</td>
      `;
      earningTable.appendChild(tr);
      totalIncome += income;
    });

    totalIncomeEl.innerText = totalIncome.toFixed(2);
  }

  function openEarningModal() {
    updateEarningTable(); // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡πà‡∏≠‡∏ô
    const modal = new bootstrap.Modal(document.getElementById('earningModal'));
    modal.show(); // ‡πÄ‡∏õ‡∏¥‡∏î modal ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
  }

  // ‚úÖ ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î modal ‡∏ã‡πâ‡∏≥ ‡πÉ‡∏ä‡πâ‡πÅ‡∏Ñ‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
  document.getElementById("shoomRate").addEventListener("input", updateEarningTable);
  
</script>

</body>
</html>
